{% extends "layouts/post_layout.html" %}


{% block title %}Detalle | IA BLOG{% endblock title %}


{% block content %}
{% if active_images %}
 <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
    {% for img in active_images %}
    <a href= "{{ img.image.url }}" target="_blank">
      <img
       src= "{{ img.image.url }}" 
       alt= "Portada del post" 
       class= "w-[400px]object-cover aspect-[16/9]" >
    </a>
    {% endfor %}
 </div>
{% endif %}
<h3 class="text-2xl uppercase font-bold">{{ post.title }}</h3>
 
  <p>{{ post.content }}</p>
  <p>Publicado por: <strong class="font-bold">{{ post.author.username }}</strong></p>
  <p>Fecha de publicaci√≥n: {{ post.creation_date }}</p>
  <p>Comentarios permitidos: {{ post.allow_comments|yesno:"Si,No" }}</p>
   <div class="flex mt-8 gap-4">
     <a 
        class="bg-blue-500 text-white p-2 rounded-lg" 
        href="{% url 'post:post_update' slug=post.slug %}"
      >Editar post</a>
     <a 
        class="bg-red-500 text-white p-2 rounded-lg" 
        href="{% url 'post:post_delete' slug=post.slug %}"
      >Eliminar post</a>
  </div>

<h4 class="mt-8 mb-4">Comentarios</h4>

{% if post.comments.count > 0 %}
  <ul>
      {% for comment in post.comments.all %}

       
       {% if comment.id == editing_comment_id %}
         <form method="post" action="{% url 'post:comment_update' comment.id %}" class= "mb-8">
           {% csrf_token %}
           <p class="flex flex-col mt-4 mb-8">{{ edit_comment_form.content.label_tag }} {{ edit_comment_form.content }}</p>
           <button type="submit">Actualizar</button>
           <a href="{% url 'post:post_detail' post.slug %}" class="text-red-500">Cancelar</a>
         </form>
        {% else %}
          <li class= "mb-8">
           <p>{{ comment.content }}</p>
           <small>Escrito por {{ comment.author.username }} el {{ comment.creation_date }}</small>
           <a href= "?edit_comment={{comment.id}}" class="text-blue-500">Editar</a>
         </li>
       {% endif %}
        
      {% endfor %}
  </ul>
{% endif %}

{% if user.is_authenticated %}
  <h4>Agregar un comentario</h4>
  <form method="post" action="{% url 'post:comment_create' post.slug %}">
    {% csrf_token %}
    <p class="flex flex-col mt-8">{{ add_comment_form.content.label_tag }} {{ add_comment_form.content}}</p>
    <button type="submit" class="bg-blue-500 text-white p-2 rounded-lg">Agregar un comentario</button>
  </form>
{% else %}
  <p>
    <a href="{% url 'user:auth_login' %}" class= "hover:text-blue-500">Inicia sesion </a> para agregar un comentario.
  </p>
{% endif %}



{% endblock content %}

{% comment %}

COLOCAR UN CONDICIONAL: SI SOS USUARIO REGISTRADO/COLABORADOR MOSTRAR BOTONES, SI NO, NO MOSTRAR. Y SOLO EL AUTOR PUEDE EDITAR SU POST
EL ADMIN SI PUEDE VER LOS BOTONES
SI SOS VISITANTE NO VES NADA
SI SOS U.REGISTRADO PODES COMENTAR

</html> {% endcomment %}
